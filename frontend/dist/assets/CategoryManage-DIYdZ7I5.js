import{l as B,c as g,a as l,b as n,w as i,h as k,f as r,o as u,g as y,B as S,i as x,v as j,F as I,r as U,t as L,j as N,A as q}from"./index-BtfrMQy-.js";import{d as D,e as F,u as O,f as T}from"./admin-sw72sElP.js";import{_ as z}from"./DataTable-D28Fm2fi.js";import{_ as b}from"./BaseButton-zFFbkYxN.js";import{_ as w}from"./BaseInput-CNSxzZWL.js";import{B as A}from"./BaseModal-DmxaG8ja.js";import{L as E}from"./LoadingSpinner-Bsqd8eRR.js";const G={class:"flex items-center justify-between mb-6"},H={class:"flex gap-2"},J=["onClick"],K=["onClick"],P=["value"],Q={class:"flex justify-end gap-3"},ae={__name:"CategoryManage",setup(R){const f=r([]),m=r(!0),d=r(!1),o=r(null),p=r(!1),a=q({name:"",slug:"",description:"",parentId:null}),C=[{key:"name",label:"分類名稱"},{key:"slug",label:"Slug"},{key:"productCount",label:"商品數"},{key:"actions",label:"操作"}];async function c(){m.value=!0;try{const s=await D();f.value=s.data||[]}finally{m.value=!1}}function _(s){o.value=s,Object.assign(a,s),d.value=!0}function v(){d.value=!1,o.value=null,Object.assign(a,{name:"",slug:"",description:"",parentId:null})}async function V(){p.value=!0;try{o.value?await O(o.value.id,a):await T(a),await c(),v()}finally{p.value=!1}}async function M(s){confirm(`確定刪除分類「${s.name}」？`)&&(await F(s.id),await c())}return B(()=>c()),(s,e)=>(u(),g("div",null,[l("div",G,[e[6]||(e[6]=l("h1",{class:"text-xl font-light tracking-wider"},"分類管理",-1)),n(b,{onClick:e[0]||(e[0]=t=>d.value=!0)},{default:i(()=>[...e[5]||(e[5]=[y("新增分類",-1)])]),_:1})]),m.value?(u(),k(E,{key:0})):(u(),k(z,{key:1,columns:C,rows:f.value},{"cell-actions":i(({row:t})=>[l("div",H,[l("button",{onClick:$=>_(t),class:"text-xs underline"},"編輯",8,J),l("button",{onClick:$=>M(t),class:"text-xs underline text-red-500"},"刪除",8,K)])]),_:1},8,["rows"])),n(A,{show:d.value,onClose:v,title:o.value?"編輯分類":"新增分類"},{default:i(()=>[l("form",{onSubmit:S(V,["prevent"]),class:"space-y-4"},[n(w,{label:"分類名稱",modelValue:a.name,"onUpdate:modelValue":e[1]||(e[1]=t=>a.name=t),required:""},null,8,["modelValue"]),n(w,{label:"Slug",modelValue:a.slug,"onUpdate:modelValue":e[2]||(e[2]=t=>a.slug=t),required:""},null,8,["modelValue"]),l("div",null,[e[7]||(e[7]=l("label",{class:"block text-xs uppercase tracking-wider text-brand-charcoal mb-1"},"描述",-1)),x(l("textarea",{"onUpdate:modelValue":e[3]||(e[3]=t=>a.description=t),rows:"3",class:"input-field w-full resize-none"},null,512),[[j,a.description]])]),x(l("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>a.parentId=t),class:"input-field w-full"},[e[8]||(e[8]=l("option",{value:null},"無上層分類",-1)),(u(!0),g(I,null,U(f.value,t=>(u(),g("option",{key:t.id,value:t.id},L(t.name),9,P))),128))],512),[[N,a.parentId]]),l("div",Q,[n(b,{variant:"secondary",onClick:v},{default:i(()=>[...e[9]||(e[9]=[y("取消",-1)])]),_:1}),n(b,{type:"submit",loading:p.value},{default:i(()=>[...e[10]||(e[10]=[y("儲存",-1)])]),_:1},8,["loading"])])],32)]),_:1},8,["show","title"])]))}};export{ae as default};
