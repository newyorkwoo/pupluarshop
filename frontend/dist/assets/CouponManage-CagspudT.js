import{l as D,c as M,a as t,b as s,w as n,h as x,f as d,o as y,g as m,t as C,x as P,y as _,q as N,B as $,i as B,j,A}from"./index-BtfrMQy-.js";import{h as T,i as G,j as R,k as S}from"./admin-sw72sElP.js";import{_ as q}from"./DataTable-D28Fm2fi.js";import{_ as b}from"./BaseButton-zFFbkYxN.js";import{_ as i}from"./BaseInput-CNSxzZWL.js";import{B as L}from"./BaseModal-DmxaG8ja.js";import{L as O}from"./LoadingSpinner-Bsqd8eRR.js";const z={class:"flex items-center justify-between mb-6"},F={class:"flex gap-2"},I=["onClick"],X=["onClick"],H={class:"grid grid-cols-2 gap-4"},J={class:"grid grid-cols-2 gap-4"},K={class:"grid grid-cols-2 gap-4"},Q={class:"flex justify-end gap-3"},se={__name:"CouponManage",setup(W){const g=d([]),p=d(!0),r=d(!1),u=d(null),c=d(!1),a=A({code:"",type:"PERCENTAGE",value:10,minPurchase:0,maxUses:100,startDate:"",endDate:""}),k=[{key:"code",label:"折扣碼"},{key:"discount",label:"折扣"},{key:"minPurchase",label:"最低消費"},{key:"usedCount",label:"已使用"},{key:"maxUses",label:"上限"},{key:"active",label:"狀態"},{key:"actions",label:"操作"}];async function f(){p.value=!0;try{const o=await T();g.value=o.data||[]}finally{p.value=!1}}function V(o){u.value=o,Object.assign(a,o),r.value=!0}function v(){r.value=!1,u.value=null,Object.assign(a,{code:"",type:"PERCENTAGE",value:10,minPurchase:0,maxUses:100,startDate:"",endDate:""})}async function E(){c.value=!0;try{u.value?await R(u.value.id,a):await S(a),await f(),v()}finally{c.value=!1}}async function w(o){confirm(`確定刪除折扣碼「${o.code}」？`)&&(await G(o.id),await f())}return D(()=>f()),(o,e)=>(y(),M("div",null,[t("div",z,[e[9]||(e[9]=t("h1",{class:"text-xl font-light tracking-wider"},"折扣碼管理",-1)),s(b,{onClick:e[0]||(e[0]=l=>r.value=!0)},{default:n(()=>[...e[8]||(e[8]=[m("新增折扣碼",-1)])]),_:1})]),p.value?(y(),x(O,{key:0})):(y(),x(q,{key:1,columns:k,rows:g.value},{"cell-active":n(({value:l})=>[t("span",{class:N([l?"text-green-600":"text-red-500","text-xs"])},C(l?"啟用":"停用"),3)]),"cell-discount":n(({row:l})=>[m(C(l.type==="PERCENTAGE"?l.value+"%":P(_)(l.value)),1)]),"cell-actions":n(({row:l})=>[t("div",F,[t("button",{onClick:U=>V(l),class:"text-xs underline"},"編輯",8,I),t("button",{onClick:U=>w(l),class:"text-xs underline text-red-500"},"刪除",8,X)])]),_:1},8,["rows"])),s(L,{show:r.value,onClose:v,title:u.value?"編輯折扣碼":"新增折扣碼"},{default:n(()=>[t("form",{onSubmit:$(E,["prevent"]),class:"space-y-4"},[s(i,{label:"折扣碼",modelValue:a.code,"onUpdate:modelValue":e[1]||(e[1]=l=>a.code=l),required:""},null,8,["modelValue"]),t("div",H,[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-xs uppercase tracking-wider text-brand-charcoal mb-1"},"折扣類型",-1)),B(t("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>a.type=l),class:"input-field w-full"},[...e[10]||(e[10]=[t("option",{value:"PERCENTAGE"},"百分比",-1),t("option",{value:"FIXED"},"固定金額",-1)])],512),[[j,a.type]])]),s(i,{label:a.type==="PERCENTAGE"?"折扣 (%)":"折扣金額",type:"number",modelValue:a.value,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value=l),modelModifiers:{number:!0},required:""},null,8,["label","modelValue"])]),t("div",J,[s(i,{label:"最低消費",type:"number",modelValue:a.minPurchase,"onUpdate:modelValue":e[4]||(e[4]=l=>a.minPurchase=l),modelModifiers:{number:!0}},null,8,["modelValue"]),s(i,{label:"使用上限",type:"number",modelValue:a.maxUses,"onUpdate:modelValue":e[5]||(e[5]=l=>a.maxUses=l),modelModifiers:{number:!0}},null,8,["modelValue"])]),t("div",K,[s(i,{label:"開始日期",type:"date",modelValue:a.startDate,"onUpdate:modelValue":e[6]||(e[6]=l=>a.startDate=l)},null,8,["modelValue"]),s(i,{label:"結束日期",type:"date",modelValue:a.endDate,"onUpdate:modelValue":e[7]||(e[7]=l=>a.endDate=l)},null,8,["modelValue"])]),t("div",Q,[s(b,{variant:"secondary",onClick:v},{default:n(()=>[...e[12]||(e[12]=[m("取消",-1)])]),_:1}),s(b,{type:"submit",loading:c.value},{default:n(()=>[...e[13]||(e[13]=[m("儲存",-1)])]),_:1},8,["loading"])])],32)]),_:1},8,["show","title"])]))}};export{se as default};
