import{A as B,o,c as r,a as e,i as p,v as c,B as z,F as j,r as A,q as E,t as i,s as M,x as u,y as f,b as x,w as L,m as C,f as v,n as q,p as F,g as U}from"./index-BtfrMQy-.js";import{u as P,v as T}from"./orderStore-BdQSSXVX.js";import{_ as D}from"./BaseBreadcrumb-DsToefPo.js";import{_ as S}from"./BaseButton-zFFbkYxN.js";const R={class:"grid grid-cols-2 gap-4"},J={class:"grid grid-cols-3 gap-4"},h={__name:"AddressForm",props:{initial:{type:Object,default:()=>({})}},emits:["submit"],setup(b){const n=b,l=B({recipient:n.initial.recipient||"",phone:n.initial.phone||"",addressLine1:n.initial.addressLine1||"",addressLine2:n.initial.addressLine2||"",city:n.initial.city||"",state:n.initial.state||"",postalCode:n.initial.postalCode||"",country:"台灣"});return(d,t)=>(o(),r("form",{onSubmit:t[7]||(t[7]=z(a=>d.$emit("submit",l),["prevent"])),class:"space-y-4"},[e("div",R,[e("div",null,[t[8]||(t[8]=e("label",{class:"text-xs uppercase tracking-wider text-brand-gray mb-1 block"},"收件人姓名",-1)),p(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>l.recipient=a),class:"input-field",required:""},null,512),[[c,l.recipient]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"text-xs uppercase tracking-wider text-brand-gray mb-1 block"},"電話",-1)),p(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>l.phone=a),class:"input-field",required:""},null,512),[[c,l.phone]])])]),e("div",null,[t[10]||(t[10]=e("label",{class:"text-xs uppercase tracking-wider text-brand-gray mb-1 block"},"地址",-1)),p(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>l.addressLine1=a),class:"input-field",placeholder:"街道地址",required:""},null,512),[[c,l.addressLine1]])]),e("div",null,[p(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>l.addressLine2=a),class:"input-field",placeholder:"樓層 / 門牌 (選填)"},null,512),[[c,l.addressLine2]])]),e("div",J,[e("div",null,[t[11]||(t[11]=e("label",{class:"text-xs uppercase tracking-wider text-brand-gray mb-1 block"},"城市",-1)),p(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>l.city=a),class:"input-field",required:""},null,512),[[c,l.city]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"text-xs uppercase tracking-wider text-brand-gray mb-1 block"},"區域",-1)),p(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>l.state=a),class:"input-field"},null,512),[[c,l.state]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"text-xs uppercase tracking-wider text-brand-gray mb-1 block"},"郵遞區號",-1)),p(e("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>l.postalCode=a),class:"input-field",required:""},null,512),[[c,l.postalCode]])])]),t[14]||(t[14]=e("button",{type:"submit",class:"btn-primary w-full"},"儲存地址",-1))],32))}},G={class:"space-y-4"},H={class:"space-y-3"},K=["value","checked","onChange"],Q={class:"text-sm font-medium"},W={class:"text-xs text-brand-gray"},X={__name:"PaymentForm",props:{modelValue:String},emits:["update:modelValue"],setup(b){const n=[{value:"credit_card",label:"信用卡",desc:"支援 VISA / Mastercard / JCB"},{value:"atm",label:"ATM 轉帳",desc:"銀行虛擬帳號轉帳"},{value:"cvs",label:"超商代碼",desc:"7-11 / 全家 / 萊爾富"},{value:"line_pay",label:"LINE Pay",desc:"使用 LINE Pay 付款"}];return(l,d)=>(o(),r("div",G,[d[0]||(d[0]=e("h3",{class:"section-title"},"付款方式",-1)),e("div",H,[(o(),r(j,null,A(n,t=>e("label",{key:t.value,class:E(["flex items-center gap-3 p-4 border cursor-pointer transition-colors",b.modelValue===t.value?"border-brand-black":"border-gray-200 hover:border-gray-400"])},[e("input",{type:"radio",value:t.value,checked:b.modelValue===t.value,onChange:a=>l.$emit("update:modelValue",t.value),class:"accent-brand-black"},null,40,K),e("div",null,[e("p",Q,i(t.label),1),e("p",W,i(t.desc),1)])],2)),64))])]))}},Y={class:"space-y-4"},Z={class:"space-y-3"},ee={class:"w-12 h-16 bg-brand-cream shrink-0 overflow-hidden"},te=["src","alt"],se={class:"flex-1"},le={class:"font-medium truncate"},ae={class:"text-brand-gray text-xs"},ne={__name:"OrderReview",setup(b){const n=M();return(l,d)=>(o(),r("div",Y,[d[0]||(d[0]=e("h3",{class:"section-title"},"訂單確認",-1)),e("div",Z,[(o(!0),r(j,null,A(u(n).items,t=>(o(),r("div",{key:t.productId,class:"flex items-center gap-3 text-sm"},[e("div",ee,[e("img",{src:t.image||"/placeholder.jpg",alt:t.name,class:"w-full h-full object-cover"},null,8,te)]),e("div",se,[e("p",le,i(t.name),1),e("p",ae,"x"+i(t.quantity),1)]),e("p",null,i(u(f)(t.price*t.quantity)),1)]))),128))])]))}},ie={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},oe={class:"grid grid-cols-1 lg:grid-cols-3 gap-10"},re={class:"lg:col-span-2 space-y-8"},de={class:"flex gap-2"},ue={key:0,class:"text-red-500 text-xs mt-1"},pe={key:1,class:"text-green-600 text-xs mt-1"},ce={class:"bg-brand-cream p-6 sticky top-24"},me={class:"border-t border-brand-gray/20 mt-4 pt-4 space-y-2 text-sm"},ve={class:"flex justify-between"},be={class:"flex justify-between"},xe={key:0,class:"flex justify-between text-green-600"},fe={class:"flex justify-between font-semibold text-base border-t border-brand-gray/20 pt-2 mt-2"},we={__name:"Checkout",setup(b){const n=F(),l=M(),d=P(),t=v({name:"",phone:"",email:"",city:"",district:"",zipCode:"",addressLine:""}),a=v("credit_card"),k=v(""),w=v(!1),_=v(""),m=v(0),V=v(!1),$=q(()=>l.totalAmount>=5e3?0:150),I=q(()=>Math.max(0,l.totalAmount+$.value-m.value));async function N(){w.value=!0,_.value="";try{const y=await T(k.value);m.value=y.data.discount||0}catch{_.value="折扣碼無效或已過期",m.value=0}finally{w.value=!1}}async function O(){V.value=!0;try{const y=await d.createOrder({address:t.value,paymentMethod:a.value,couponCode:k.value||void 0,items:l.items.map(s=>({productId:s.productId,size:s.size,quantity:s.quantity}))});l.clearCart(),n.push({name:"OrderConfirmation",params:{id:y.id}})}catch{}finally{V.value=!1}}return(y,s)=>(o(),r("div",ie,[x(D,{items:[{label:"首頁",to:"/"},{label:"結帳"}],class:"mb-8"}),s[13]||(s[13]=e("h1",{class:"text-2xl font-light tracking-wider mb-8"},"結帳",-1)),e("div",oe,[e("div",re,[e("section",null,[s[3]||(s[3]=e("h2",{class:"text-sm uppercase tracking-[0.15em] font-semibold mb-4"},"1. 配送資訊",-1)),x(h,{modelValue:t.value,"onUpdate:modelValue":s[0]||(s[0]=g=>t.value=g)},null,8,["modelValue"])]),e("section",null,[s[4]||(s[4]=e("h2",{class:"text-sm uppercase tracking-[0.15em] font-semibold mb-4"},"2. 付款方式",-1)),x(X,{modelValue:a.value,"onUpdate:modelValue":s[1]||(s[1]=g=>a.value=g)},null,8,["modelValue"])]),e("section",null,[s[6]||(s[6]=e("h2",{class:"text-sm uppercase tracking-[0.15em] font-semibold mb-4"},"折扣碼",-1)),e("div",de,[p(e("input",{"onUpdate:modelValue":s[2]||(s[2]=g=>k.value=g),type:"text",placeholder:"輸入折扣碼",class:"input-field flex-1"},null,512),[[c,k.value]]),x(S,{variant:"secondary",onClick:N,loading:w.value},{default:L(()=>[...s[5]||(s[5]=[U("套用",-1)])]),_:1},8,["loading"])]),_.value?(o(),r("p",ue,i(_.value),1)):C("",!0),m.value>0?(o(),r("p",pe,"已折抵 "+i(u(f)(m.value)),1)):C("",!0)])]),e("div",null,[e("div",ce,[s[12]||(s[12]=e("h2",{class:"text-sm uppercase tracking-[0.15em] font-semibold mb-4"},"訂單摘要",-1)),x(ne,{items:u(l).items},null,8,["items"]),e("div",me,[e("div",ve,[s[7]||(s[7]=e("span",null,"小計",-1)),e("span",null,i(u(f)(u(l).totalAmount)),1)]),e("div",be,[s[8]||(s[8]=e("span",null,"運費",-1)),e("span",null,i($.value===0?"免運費":u(f)($.value)),1)]),m.value>0?(o(),r("div",xe,[s[9]||(s[9]=e("span",null,"折扣",-1)),e("span",null,"-"+i(u(f)(m.value)),1)])):C("",!0),e("div",fe,[s[10]||(s[10]=e("span",null,"合計",-1)),e("span",null,i(u(f)(I.value)),1)])]),x(S,{onClick:O,loading:V.value,class:"w-full mt-6"},{default:L(()=>[...s[11]||(s[11]=[U("確認下單",-1)])]),_:1},8,["loading"])])])])]))}};export{we as default};
